{% extends "base.html" %}

{% block title %}Dashboard - SOC Email Log{% endblock %}

{% block content %}
<h1 style="color: #3b82f6; margin-bottom: 2rem;"> Phishing Threat Dashboard</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="label">Total Emails Logged</div>
        <div class="value">{{ stats.total_emails }}</div>
    </div>
    
    <div class="stat-card">
        <div class="label">Logged Today</div>
        <div class="value">{{ stats.this_week }}</div>
    </div>
    
    <div class="stat-card">
        <div class="label">Unique Sender Domains</div>
        <div class="value">{{ stats.unique_domains }}</div>
    </div>
    
    <div class="stat-card">
        <div class="label">Unique Sender IPs</div>
        <div class="value">{{ stats.unique_ips }}</div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2> Quick Actions</h2>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <a href="{{ url_for('main.log_email') }}" class="btn btn-primary" style="text-align: center;">
             Log New Email
        </a>
        <a href="{{ url_for('main.list_emails') }}" class="btn btn-secondary" style="text-align: center;">
             View All Emails
        </a>
        <a href="{{ url_for('main.stats') }}" class="btn btn-secondary" style="text-align: center;">
             View Analytics
        </a>
    </div>
</div>

{% if recent_emails %}
<div class="card">
    <div class="card-header">
        <h2> Recently Logged Emails</h2>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>From</th>
                <th>Subject</th>
                <th>Sender Domain</th>
                <th>Type</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for email in recent_emails %}
            <tr>
                <td style="white-space: nowrap;">
                    {{ email.created_at.strftime('%Y-%m-%d %H:%M') }}
                </td>
                <td>
                    <code style="font-size: 0.85rem;">{{ email.from_address[:30] }}...</code>
                </td>
                <td>
                    {{ email.subject[:50] }}{% if email.subject|length > 50 %}...{% endif %}
                </td>
                <td>
                    <span class="badge badge-info">{{ email.sender_domain }}</span>
                </td>
                <td>
                    <span class="badge badge-danger">{{ email.threat_type }}</span>
                </td>
                <td>
                    <a href="{{ url_for('main.view_email', email_id=email.id) }}" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                        View â†’
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div style="margin-top: 1rem; text-align: center;">
        <a href="{{ url_for('main.list_emails') }}" class="btn btn-secondary">
            View All Emails â†’
        </a>
    </div>
</div>
{% else %}
<div class="card" style="text-align: center; padding: 3rem;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“­</div>
    <h3 style="color: #9ca3af; margin-bottom: 1rem;">No Emails Logged Yet</h3>
    <p class="text-muted" style="margin-bottom: 2rem;">
        Start tracking phishing threats by logging your first email
    </p>
    <a href="{{ url_for('main.log_email') }}" class="btn btn-primary">
        Log Your First Email
    </a>
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h2>ðŸ’¡ Threat Hunting Tips</h2>
    </div>
    <div style="display: grid; gap: 1rem;">
        <div style="padding: 1rem; background: #0f1419; border-radius: 6px; border-left: 3px solid #3b82f6;">
            <strong style="color: #3b82f6;">Look for Domain Mismatches</strong>
            <p class="text-muted mt-1">Compare the From domain with Return-Path domain - differences indicate spoofing</p>
        </div>
        <div style="padding: 1rem; background: #0f1419; border-radius: 6px; border-left: 3px solid #10b981;">
            <strong style="color: #10b981;">Check Authentication Results</strong>
            <p class="text-muted mt-1">Failed SPF/DKIM/DMARC checks are red flags for illegitimate senders</p>
        </div>
        <div style="padding: 1rem; background: #0f1419; border-radius: 6px; border-left: 3px solid #f59e0b;">
            <strong style="color: #f59e0b;">Track Patterns</strong>
            <p class="text-muted mt-1">Group similar emails by subject/sender - campaigns often reuse infrastructure</p>
        </div>
    </div>
</div>
{% endblock %}